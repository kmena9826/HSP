
@model  CS_HOSPITALARIO_Front_end.Models.ViewModel.LaboratorioViewModel
@{

    //Layout = Request.IsAjaxRequest() ? null : "~/Views/Shared/_Layout.cshtml";

    ViewBag.Title = "Lista De Trabajo";
    ViewBag.Modulo = "mAdmision";
}
<script src="~/Scripts/vendor.js"></script>
<link href="~/Content/animate.css" rel="stylesheet" />

<script>

    function ValidarForm() {

        let isvalid = true;

        var inicio = $("#desde");
        inicio.removeClass("is-invalid");

        var fin = $("#hasta");
        fin.removeClass("is-invalid");


        if (inicio.val() == "") {

            $.notify({ message: 'La fecha desde no puede estar vacia' }, { type: 'danger' });
            paciente.addClass("is-invalid");
            isvalid = false;
        }
        if (fin.val() == "") {

            $.notify({ message: 'La fecha hasta no puede estar vacia' }, { type: 'danger' });
            causa.addClass("is-invalid");
            isvalid = false;

        }

        if (inicio.val() != "" || fin.val() != "") {
            if (inicio < fin) {
                $.notify({ message: 'La fecha hasta no puede ser menor que la fecha desde' }, { type: 'danger' });
                causa.addClass("is-invalid");
                isvalid = false;
            }
        }

        return isvalid;
    };
</script>
<div class="row m-0 gap-20 masonry pos-r">
    <div class="masonry-item w-100">
        <div class="row gap-20">
            <div class="masonry-item col-md-12 col-sm-12">
                <div class="bd bgc-white">
                    <div class="layers">
                        <div class="ta-c w-100 p-10">
                            <h4 class="float-left"><span class="color-secondary-h text-uppercase">@ViewBag.Title</span></h4>
                            <nav class="float-right m-0" aria-label="breadcrumb">
                                <ol class="breadcrumb bg-color-blanco">
                                    <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")">Principal</a></li>
                                    <li class="breadcrumb-item"><a href="@Url.Action("Index","Admision")">Admisión Laboratorio</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">@ViewBag.Title</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row m-0 gap-20 masonry pos-r">
    <div class="masonry-item w-100">
        <div class="row gap-20">
            <div class="masonry-item col-md-12 col-sm-12">
                <div class="bgc-white p-20 bd">
                    <h3>@ViewBag.Title</h3>
                    <hr style="padding-bottom:20px" />
                    <div class="col-md-12"></div>
                    <div class="col-md-12"></div>

                    @*@{
                            Html.EnableClientValidation();
                        }*@

                    @using (Ajax.BeginForm("ListaTrabajo", "Laboratorio", new AjaxOptions { UpdateTargetId = "tabla_examenes", HttpMethod = "Post", InsertionMode = InsertionMode.Replace, OnSuccess = "return ValidarForm();" }))
                    {
                        @Html.ValidationSummary(true)

                        <table border="0" cellspacing="5" cellpadding="5">
                            <tbody>
                                <tr>
                                    <td>Desde:</td>
                                    <td>
                                        @Html.TextBoxFor(model => model.desde, "{0:yyyy-MM-dd}", new { @class = "form-control", @type = "date" })
                                        @Html.ValidationMessageFor(model => model.desde, "", new { @class = "text-danger" })
                                    </td>
                                    <td>al:</td>
                                    <td>
                                        @Html.TextBoxFor(model => model.hasta, "{0:yyyy-MM-dd}", new { @class = "form-control", @type = "date" })
                                        @Html.ValidationMessageFor(model => model.hasta, "", new { @class = "text-danger" })
                                    </td>
                                    <td> </td>
                                    <td>  <input type="submit" name="btnsearch" value="Filtrar" /></td>
                                </tr>
                                <tr></tr>
                            </tbody>
                        </table>

                    }
                    <div id="refreshtable">

                        <table class="table datatable table-responsive table-hover" id="tabla_examenes">
                            <thead>
                                <tr>
                                <tr>
                                    <th>Reg</th>
                                    <th>
                                        N° Muestra
                                    </th>
                                    <th>
                                        Cod Examen
                                    </th>
                                    <th>
                                        Examen
                                    </th>
                                    <th>
                                        Cod Cliente
                                    </th>
                                    <th>
                                        Cliente
                                    </th>
                                    <th>
                                        STAT
                                    </th>
                                    <th>
                                        Estado
                                    </th>
                                    <th>
                                        Fecha Recepcion
                                    </th>
                                    <th>
                                        Usuario R
                                    </th>
                                    <th>
                                        Usuario TM
                                    </th>
                                    <th>
                                        Fecha TM
                                    </th>
                                    <th>Cod Admision</th>
                                    <th>
                                        Fecha de Admision
                                    </th>

                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.ListadoExamenLaboratorioRecepcionado_Result)
                                {
                                <tr>
                                   
                                    <td>
                                        @switch (item.ESTADO)
                                        {
                                            case "R":
                                                <a title="Registrar Resultado" class="btn btn-warning" href="@Url.Action("RegistrarResultadoLaboratorio", "Laboratorio")/@item.NUM_MUESTRA" target="_blank"><i class="fas fa-clipboard-list"></i></a>
                                                <a title="Imprimir Etiqueta" class="btn btn-dark" href="@Url.Action("FormartoEmprimirEtiqueta", "Laboratorio", new {muestra= @item.NUM_MUESTRA})" target="_blank"><i class="fas fa-tags"></i></a>
                                                break;
                                            case "I":
                                                <a title="Editar Resultado" class="btn btn-primary" href="@Url.Action("RegistrarResultadoLaboratorio", "Laboratorio")/@item.NUM_MUESTRA" target="_blank" style="margin-bottom:5px"><i class="fas fa-clipboard-list"></i></a>
                                                <a title="Imprimir Resultado" class="btn btn-info" href="@Url.Action("rptExamenLab", "Laboratorio")/@item.NUM_MUESTRA" target="_blank" style="margin-bottom:5px"><i class="fas fa-print"></i></a>
                                                @*<a title="Enviar Resultado" class="btn btn-success" href="@Url.Action("RegistrarResultadoLaboratorio", "Laboratorio")/@item.NUM_MUESTRA"><i class="fas fa-paper-plane"></i></a>*@
                                                <a title="Imprimir Etiqueta" class="btn btn-dark" href="@Url.Action("FormartoEmprimirEtiqueta", "Laboratorio", new {muestra= @item.NUM_MUESTRA})" target="_blank"><i class="fas fa-tags"></i></a>
                                                break;
                                            case "C":
                                                @*<a title="Registrar Resultado" class="btn btn-primary" href="@Url.Action("EditarResultadoLaboratorio", "Laboratorio")/@item.NUM_MUESTRA" style="margin-bottom:5px"><i class="fas fa-clipboard-list"></i></a>*@
                                                <a title="Imprimir Resultado" class="btn btn-info" href="@Url.Action("rptExamenLab", "Laboratorio")/@item.NUM_MUESTRA" target="_blank" style="margin-bottom:5px"><i class="fas fa-print"></i></a>
                                                <a title="Enviar Resultado" class="btn btn-success" href="#" target="_blank"><i class="fas fa-paper-plane"></i></a>
                                                <a title="Imprimir Etiqueta" class="btn btn-dark" href="@Url.Action("FormartoEmprimirEtiqueta", "Laboratorio", new {muestra= @item.NUM_MUESTRA})" target="_blank"><i class="fas fa-tags"></i></a>
                                                break;

                                        }

                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.NUM_MUESTRA)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.ID_EXAMEN)
                                    </td>
                                    <td>@Html.DisplayFor(modelItem => item.DESC_ARTICULO)</td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.CLIENTE_ID)
                                    </td>
                                    <td> @Html.DisplayFor(modelItem => item.CLIENTE)</td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.STAT)
                                    </td>
                                    <td>
                                        @switch (item.ESTADO)
                                        {
                                            case "R":
                                                <span class="badge badge-primary">@Html.DisplayFor(modelItem => item.ESTADO_DESCRIPCION)</span>
                                                break;
                                            case "I":
                                                <span class="badge badge-warning">@Html.DisplayFor(modelItem => item.ESTADO_DESCRIPCION)</span>
                                                break;
                                            case "C":
                                                <span class="badge badge-success">@Html.DisplayFor(modelItem => item.ESTADO_DESCRIPCION)</span>
                                                break;
                                            default:
                                                @Html.DisplayFor(modelItem => item.ESTADO_DESCRIPCION)
                                                break;
                                        }

                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.FECHA_RECEPCION)
                                    </td>


                                    <td>
                                        @Html.DisplayFor(modelItem => item.USUARIO_RECEPCION_MUESTRA)
                                    </td>


                                    <td>
                                        @Html.DisplayFor(modelItem => item.USUARIO_TOMA_MUESTRA)
                                    </td>


                                    <td>
                                        @Html.DisplayFor(modelItem => item.FECHA_TOMA_MUESTRA)
                                    </td>


                                    <td> @Html.DisplayFor(modelItem => item.ADMISION)</td>


                                    <td>
                                        @Html.DisplayFor(modelItem => item.FECHA_CREACION)
                                    </td>


                                </tr>
                                }

                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Reg</th>
                                    <th>
                                        N° Muestra
                                    </th>
                                    <th>
                                        Cod Examen
                                    </th>
                                    <th>
                                        Examen
                                    </th>
                                    <th>
                                        Cod Cliente
                                    </th>
                                    <th>
                                        Cliente
                                    </th>
                                    <th>
                                        STAT
                                    </th>
                                    <th>
                                        Estado
                                    </th>
                                    <th>
                                        FECHA RECEPCION
                                    </th>
                                    <th>
                                        Usuario R
                                    </th>
                                    <th>
                                        Usuario TM
                                    </th>
                                    <th>
                                        Fecha TM
                                    </th>
                                    <th>Cod Admision</th>
                                    <th>
                                        Fecha de Admision
                                    </th>

                                </tr>
                            </tfoot>
                        </table>
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>
<link href="~/Content/DataTables/css/PagedList.css" rel="stylesheet" />
<link href="~/Content/DataTables/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="~/Content/DataTables/css/buttons.dataTables.min.css" rel="stylesheet" />
<link href="~/Content/DataTables/css/DataTableSearch.css" rel="stylesheet" />

@section scripts
{
    @*<script src="~/Scripts/bootstrap.js"></script>*@

    <script src="~/Scripts/bootstrap-notify.js"></script>
    @Scripts.Render("~/bundles/jquery")
    <script src="~/Scripts/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/dataTables.buttons.min.js"></script>
    <script src="~/Scripts/buttons.flash.min.js"></script>
    <script src="~/Scripts/jszip.min.js"></script>
    <script src="~/Scripts/buttons.html5.min.js"></script>
    <script src="~/Scripts/dataTables.select.min.js"></script>
    <script src="~/Scripts/pdfmake.min.js"></script>
    <script src="~/Scripts/vfs_fonts.js"></script>
    @Scripts.Render("~/bundles/jqueryval")
    <script type="text/javascript">
        /* INICIALIZACIÓN */
        $(document).ready(function () {




            $('#tabla_examenes tfoot th').each(function () {
                var title = $(this).text().trim();
                $(this).html('<input class="form-control" type="text" placeholder="Buscar por ' + title + '" />');
            });
            var events = $('#events');
            var table = $('#tabla_examenes').DataTable({
                "order": [[0, "desc"]],
                "columns": [
                    { "width": "5%" },
                    { "width": "10%" },
                    { "width": "10%" },
                    { "width": "15%" },
                    { "width": "10%" },
                    { "width": "10%" },
                    { "width": "15%" },
                    { "width": "10%" },
                    { "width": "10%" },
                    { "width": "10%" },
                    { "width": "10%" },
                    { "width": "10%" },
                    { "width": "5%" },
                    { "width": "10%" },
                ],
                dom: 'Bfrtip',
                select: false,
                buttons: ["pdf", "excel"]
            });
            // Apply the search
            table.columns().every(function () {
                var that = this;
                $('input', this.footer()).on('keyup change', function () {
                    if (that.search() !== this.value) {
                        that
                            .search(this.value)
                            .draw();
                    }
                });
            });
            $('#tabla_examenes tfoot tr').appendTo('#tabla_examenes thead');
            $('#tabla_examenes_filter input').addClass("form-control");
            $("#tabla_examenes_wrapper button").each(function () {
                $(this).removeClass("dt-button");

                $(this).addClass("btn btn-sm");
                if ($(this).text() == 'PDF' || $(this).text() == 'Excel') {
                    $(this).addClass("btn-secondary");
                }
                else {
                    $(this).addClass("btn-primary ");
                }

            });

        });
    </script>

}

