@model CS_HOSPITALARIO.Models.CS_PACIENTES

<h2>@ViewBag.Title</h2>

<hr />

@using (Html.BeginForm())
{
        <div class="container">
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            @if (ViewBag.Accion == "Editar")
            {
                @Html.HiddenFor(model => model.ID_PACIENTE)
            }
            <div class="form-inline row">
                <label class="control-label col-md-2 text-right">Código:</label>
                <div class="input-group">
                    @if (ViewBag.Accion == "Editar")
                    {
                        @Html.EditorFor(model => model.CLIENTE_ID, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                    }
                    else
                    {
                        @Html.EditorFor(model => model.CLIENTE_ID, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly", @Value = ViewBag.CLIENTE_ID } })
                    }
                    @Html.ValidationMessageFor(model => model.CLIENTE_ID, "", new { @class = "text-danger" })
                    @if (ViewBag.Accion != "Editar")
                    {
                        <div class="input-group-btn">
                            <a id="callModal" class="btn btn-primary">
                                <i class="glyphicon glyphicon-search"></i>
                            </a>
                        </div>
                    }
                </div>
            </div>
            <hr />
            <div class="row">
                <div class="form-group col-md-6">
                    <label class="control-label col-md-4 text-right">Nombres:</label>
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.NOMBRES, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.NOMBRES, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label class="control-label col-md-4 text-right">Apellidos:</label>
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.APELLIDOS, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.APELLIDOS, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-6">
                    <label class="control-label col-md-4 text-right">Sexo:</label>
                    <div class="col-md-8">
                        <label class="radio-inline col-md-4">
                            @Html.RadioButtonFor(model => model.SEXO, "F") Femenino
                        </label>
                        <label class="radio-inline col-md-4">
                            @Html.RadioButtonFor(model => model.SEXO, "M") Masculino
                        </label>
                        @Html.ValidationMessageFor(model => model.SEXO, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label class="control-label col-md-4 text-right">Estado Civil:</label>
                    <div class="col-md-8">
                        @Html.DropDownList("ESTADO_CIVIL_ID", null, "Seleccione...", htmlAttributes: new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.ESTADO_CIVIL_ID, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <hr />
            <div class="row">
                <div class="form-group col-md-4">
                    <label class="control-label col-md-4 text-right">Identificación:</label>
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.IDENTIFICACION, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.IDENTIFICACION, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="control-label col-md-4 text-right">Fecha de Nacimiento:</label>
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.FECHA_NACIMIENTO, new { htmlAttributes = new { @class = "form-control", @type = "date" } })
                        @Html.ValidationMessageFor(model => model.FECHA_NACIMIENTO, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="control-label col-md-4 text-right">Tipo de Sangre:</label>
                    <div class="col-md-8">
                        @Html.DropDownList("TIPO_SANGRE_ID", null, "Seleccione...", htmlAttributes: new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.TIPO_SANGRE_ID, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-4">
                    <label class="control-label col-md-4 text-right">N° Seguro Social:</label>
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.NUM_SEGURO_SOCIAL, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.NUM_SEGURO_SOCIAL, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="control-label col-md-4 text-right">Aseguradora:</label>
                    <div class="col-md-8">
                        @Html.DropDownList("ASEGURADORA_ID", null, "Seleccione...", htmlAttributes: new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.ASEGURADORA_ID, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="control-label col-md-4 text-right">Tipo de Asegurado:</label>
                    <div class="col-md-8">
                        @Html.DropDownList("TIPO_ASEGURADO_ID", null, "Seleccione...", htmlAttributes: new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.TIPO_ASEGURADO_ID, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <hr />
            <div class="row">
                <div class="form-group col-md-3">
                    <label class="control-label col-md-6 text-right">N° Teléfono:</label>
                    <div class="col-md-6">
                        @if (ViewBag.Accion != "Editar")
                        {
                            <input class="form-control text-box single-line" id="TEL1" name="TEL1" type="text" value="">
                        }
                        else
                        {
                            @Html.EditorFor(model => model.CLIENTE.TELEFONO1, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.CLIENTE.TELEFONO1, "", new { @class = "text-danger" })
                        }
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="control-label col-md-6 text-right">Teléfono (otro):</label>
                    <div class="col-md-6">
                        @if (ViewBag.Accion != "Editar")
                        {
                            <input class="form-control text-box single-line" id="TEL2" name="TEL2" type="text" value="">
                        }
                        else
                        {
                            @Html.EditorFor(model => model.CLIENTE.TELEFONO2, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.CLIENTE.TELEFONO2, "", new { @class = "text-danger" })
                        }
                    </div>
                </div>
                <div class="form-group col-md-5">
                    <label class="control-label col-md-4 text-right">Correo Electrónico:</label>
                    <div class="col-md-8">
                        @if (ViewBag.Accion != "Editar")
                        {
                            <input class="form-control text-box single-line" id="EMAIL" name="EMAIL" type="text" value="">
                        }
                        else
                        {
                            @Html.EditorFor(model => model.CLIENTE.E_MAIL, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.CLIENTE.E_MAIL, "", new { @class = "text-danger" })
                        }
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-12">
                    <label class="control-label col-md-1 text-right">Dirección:</label>
                    <div class="col-md-11">
                        @if (ViewBag.Accion != "Editar")
                        {
                            <textarea class="form-control ocupar-todo" cols="20" id="DIRECCION" name="DIRECCION" rows="2"></textarea>
                        }
                        else
                        {
                            @Html.TextAreaFor(model => model.CLIENTE.DIRECCION, new { @class = "form-control ocupar-todo", @rows = 2 })
                            @Html.ValidationMessageFor(model => model.CLIENTE.DIRECCION, "", new { @class = "text-danger" })
                        }
                    </div>
                </div>
            </div>
            <hr />
            <div class="row">
                <div class="form-group col-md-4">
                    <label class="control-label col-md-4 text-right">Escolaridad:</label>
                    <div class="col-md-8">
                        @Html.DropDownList("ESCOLARIDAD_ID", null, "Seleccione...", htmlAttributes: new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.ESCOLARIDAD_ID, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="control-label col-md-4 text-right">Profesión:</label>
                    <div class="col-md-8">
                        @Html.DropDownList("PROFESION_ID", null, "Seleccione...", htmlAttributes: new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.PROFESION_ID, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="control-label col-md-4 text-right">Religión:</label>
                    <div class="col-md-8">
                        @Html.DropDownList("RELIGION_ID", null, "Seleccione...", htmlAttributes: new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.RELIGION_ID, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <hr />
            <div class="row">
                <div class="form-group col-md-12">
                    <label class="control-label col-md-2 text-right">Observaciones:</label>
                    <div class="col-md-10">
                        @Html.TextAreaFor(model => model.OBSERVACIONES, new { @class = "form-control ocupar-todo", @rows = 3 })
                        @Html.ValidationMessageFor(model => model.OBSERVACIONES, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <hr />
            <div class="form-group">
                <div class="col-md-10">
                    <div class="text-left">
                        <input type="submit" value="Guardar" class="btn btn-primary" />
                        @Html.ActionLink("Cancelar", "Pacientes", "Admision", null, new { @class = "btn btn-default" })
                    </div>
                </div>
            </div>

        </div>
        }

<div id='myModal' class='modal fade' tabindex="-1" role="dialog" aria-labelledby="classInfo" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h2 class="modal-title" id="myModalLabel">Pacientes registrados en Softland</h2>
            </div>
            <div class="modal-body">
                <table class="table table-hover" id="tabla_pac_softland">
                    <thead>
                        <tr>
                            <th>
                                ID Softland
                            </th>
                            <th>
                                Nombre Completo
                            </th>
                        </tr>
                    </thead>
                    <tbody id="cuerpo-datos-modal">
                        @*<tr>
                            <td>
                                YO
                            </td>
                            <td>
                                Miguel
                            </td>
                        </tr>
                        <tr>
                            <td>
                                EL
                            </td>
                            <td>
                                Elías
                            </td>
                        </tr>*@
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    @*@Html.Partial("_ListadoPacientesSoftland");*@
    
</div>


<link href="~/Content/DataTables/css/PagedList.css" rel="stylesheet" />
<link href="~/Content/DataTables/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="~/Content/DataTables/css/buttons.dataTables.min.css" rel="stylesheet" />
<link href="~/Content/DataTables/css/DataTableSearch.css" rel="stylesheet" />

@section scripts
{
    <script src="~/Scripts/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/dataTables.select.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            var url = '/admision/popup';
            $.get(url, function (data) {
                $('#cuerpo-datos-modal').html(data);
                //$('#myModal').modal('show');
            });

            $('#callModal').click(function () {
                var events = $('#events');
                var table = $('#tabla_pac_softland').DataTable({
                    dom: 'Bfrtip',
                    language: {
                        select: {
                            rows: {
                                0: "",
                                1: " │ %d registro seleccionado."
                            }
                        }
                    },
                    select: {
                        style: 'single'
                    }
                });

                $('#tabla_pac_softland tbody').on('dblclick', 'tr', function () {
                    var data = table.row(this).data();
                    alert('You clicked on ' + data[0] + '\'s row');
                });

                $('#tabla_pac_softland tbody').on('dblclick', 'tr', function () {

                    var rowSelected = table.rows({ selected: true }).data();

                    //window.location.href = '/Catalogos/EditarCatalogoMaestro/' + rowSelected[0][0];
                    var data = table.rowSelected.data();
                    //table.row(this).data();
                    if (typeof data === 'undefined') {
                        console.log("data no está definido");
                    } else {
                        console.log("data está definido");
                    }
                    alert('You are Double clicked on ' + data[0] + '\'s row');
                });

                $('#myModal').modal('show');
            });

            
            $('#CLIENTE_ID').on('change', function () {
                $('#idClienteSoftland').val(this.value);
                var item = $('#CLIENTE_ID option:selected').text();
                var separador = " ";
                var nombresApellidos = item.split(separador);
                if (nombresApellidos.length > 1) {
                    var pos = Math.floor(nombresApellidos.length / 2);
                    var nombre = [];
                    for (var i = 0; i < pos; i++) {
                        nombre.push(nombresApellidos[i]);
                    }
                    $('#NOMBRES').val(nombre.join(' '));
                    var apellido = [];
                    for (var i = pos; i < nombresApellidos.length; i++) {
                        apellido.push(nombresApellidos[i]);
                    }
                    $('#APELLIDOS').val(apellido.join(' '));
                }
                else {
                    $('#NOMBRES').val(item.toString());
                    $('#APELLIDOS').val("");
                }

            });
        });
    </script>

    
}
